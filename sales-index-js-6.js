(window.webpackJsonp=window.webpackJsonp||[]).push([[6],[,,,,,,,,function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return l}));var r=s(14),n=s(11);var i=[{id:"id",title:"ID",sortable:!0,sortType:"number"},{id:"user",title:"User",sortable:!0,sortType:"string"},{id:"createdAt",title:"Created At",sortable:!0,sortType:"date",template:e=>`<div class="sortable-table__cell">\n                ${new Date(e).toLocaleString("ru",{dateStyle:"medium"})}\n              </div>`},{id:"totalCost",title:"Total Cost",sortable:!0,sortType:"number",template:e=>`<div class="sortable-table__cell">$${e.toLocaleString("en-US")}</div>`},{id:"delivery",title:"Delivery",sortable:!0,sortType:"number"}],a=s(10);function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class l{constructor(){o(this,"element",null),o(this,"subElements",{}),this.range={from:new Date,to:new Date},this.range.from=Object(a.a)(this.range.from,this.range.from.getUTCMonth()-1)}render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element),this.initComponents(),this.renderComponents(),this.initEventListeners(),this.element}get template(){return'\n        <div class="sales full-height flex-column">\n\n            <div class="content__top-panel">\n              <h2 class="page-title">Sales</h2>\n              \x3c!-- RangePicker --\x3e\n              <div data-element="rangePicker"></div>\n            </div>\n\n            \x3c!-- ordersContainer --\x3e\n            <div data-element="ordersContainer" class="full-height flex-column"></div>\n        </div>'}initComponents(){const e=new r.a(this.range),t=new n.a(i,{url:`api/rest/orders?createdAt_gte=${this.range.from.toISOString()}&createdAt_lte=${this.range.to.toISOString()}`,isSortLocally:!1,sorted:{id:"createdAt",order:"desc"},emptyPlaceholder:"<div><p>No orders</p></div>",isRowALink:!1});this.components={rangePicker:e,ordersContainer:t}}renderComponents(){Object.keys(this.subElements).forEach(e=>{this.subElements[e].append(this.components[e].element)})}initEventListeners(){this.element.addEventListener("date-select",e=>{this.range=e.detail,this.updateComponents(this.range)})}updateComponents(e){const{from:t,to:s}=e,r=`api/rest/orders?createdAt_gte=${t.toISOString()}&createdAt_lte=${s.toISOString()}`;this.components.ordersContainer.update(r)}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={};for(const e of Object.values(this.components))e.destroy()}}},function(e,t,s){"use strict";t.a=async function(e,t){let s,n;try{s=await fetch(e.toString(),t)}catch(e){throw new r(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{n=await s.json(),e=n.error&&n.error.message||n.data&&n.data.error&&n.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new r(s,n,t)}try{return await s.json()}catch(e){throw new r(s,null,e.message)}};class r extends Error{constructor(e,t,s){var r,n,i;super(s),i="FetchError",(n="name")in(r=this)?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof r&&alert(e.reason.message)})},function(e,t,s){"use strict";t.a=(e,t)=>{const s=e.getUTCDate();return e.setUTCMonth(Number(t)),e.getUTCDate()!==s&&e.setUTCDate(0),e}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(9);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e=[],{url:t="",isSortLocally:s=!1,sorted:r={id:e.find(e=>e.sortable).id,order:"asc"},emptyPlaceholder:i="<div><p>No data</p></div>",isRowALink:a=!0}={}){n(this,"element",null),n(this,"subElements",{}),n(this,"data",[]),n(this,"loadStart",0),n(this,"loadLength",30),n(this,"isLoading",!1),n(this,"pointerdownHandler",e=>{const t=e.target.closest('[data-sortable = "true"]');t&&(e.preventDefault(),this.sorted.id=t.dataset.id,this.sorted.order="desc"===t.dataset.order?"asc":"desc",Array.from(this.subElements.header.children).map(e=>e.dataset.order=""),t.dataset.order=this.sorted.order,this.isSortLocally?this.sortOnClient(this.sorted.id,this.sorted.order):this.sortOnServer(this.sorted.id,this.sorted.order))}),n(this,"scrollHandler",async e=>{if(this.isSortLocally)return;const t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-document.documentElement.clientHeight;if(window.pageYOffset===t&&!this.isLoading){this.loadStart=this.loadStart+this.loadLength,this.isLoading=!0;const e=await this.loadData();(0===e.length||e.length<this.loadLength)&&document.removeEventListener("scroll",this.scrollHandler),this.updateTableData([...this.data,...e]),this.isLoading=!1}}),this.url=t,this.isSortLocally=s,this.headerConfig=e,this.sorted=r,this.emptyPlaceholder=i,this.isRowALink=a,this.render()}async render(){const e=document.createElement("div"),{id:t,order:s}=this.sorted;e.innerHTML=this.getTable(),this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element);const r=await this.loadData(t,s);this.subElements.header.innerHTML=this.getHeaderRow(),this.subElements.emptyPlaceholder.innerHTML=this.emptyPlaceholder,this.updateTableData(r),this.initEventListeners()}getTable(){return'\n      <div class="sortable-table">\n          <div data-element="header" class="sortable-table__header sortable-table__row"></div>\n          <div data-element="body" class="sortable-table__body"></div>\n          <div data-element="loading" class="loading-line sortable-table__loading-line"></div>\n          <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder"></div>\n      </div>\n    '}getHeaderRow(){return this.headerConfig.map(({id:e,sortable:t,title:s})=>`\n        <div class="sortable-table__cell"\n            data-id="${e}"\n            data-sortable="${t}"\n            data-order="${e===this.sorted.id?this.sorted.order:""}"\n            <span>${s}</span>\n            <span data-element="arrow" class="sortable-table__sort-arrow">\n                <span class="sort-arrow"></span>\n            </span>\n        </div>\n      `).join("")}getBodyRows(e){return e.map(e=>this.isRowALink?`<a href="/products/${e.id}" class="sortable-table__row">${this.getBodyRow(e)}</a>`:`<div class="sortable-table__row">${this.getBodyRow(e)}</div>`).join("")}getBodyRow(e){return Array.from(this.headerConfig).map(({id:t,template:s})=>s?s(e[t]):`<div class="sortable-table__cell">${e[t]}</div>`).join("")}async update(e){this.url=e,this.loadStart=0;const t=await this.loadData();t.length&&document.addEventListener("scroll",this.scrollHandler),this.updateTableData(t)}updateTableData(e){this.data=e,e.length?(this.element.classList.remove("sortable-table_empty"),this.isSortLocally&&Array.from(this.subElements.header.children).map(e=>e.dataset.order=""),this.subElements.body.innerHTML=this.getBodyRows(e)):this.element.classList.add("sortable-table_empty")}sortOnClient(e,t){const s=this.sort(e,t);this.subElements.body.innerHTML=this.getBodyRows(s)}async sortOnServer(e,t){this.loadStart=0;const s=await this.loadData(e,t);s.length&&document.addEventListener("scroll",this.scrollHandler),this.updateTableData(s)}sort(e,t){const s=this.headerConfig.find(t=>t.id===e),{sortType:r,customSorting:n}=s;return Array.from(this.data).sort((s,i)=>{const a=s[e],o=i[e];let l=null;switch(r){case"number":l=a-o;break;case"string":l=a.localeCompare(o,["ru-u-kf-upper","en-u-kf-upper"]);break;case"date":l=new Date(a)-new Date(o);break;case"custom":l=n(a,o);break;default:l=a-o}return"asc"===t?l:"desc"===t?-l:void 0})}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}async loadData(e=this.sorted.id,t=this.sorted.order,s=this.loadStart,n=this.loadLength){if(!this.url)return;this.setLoadingInd();const i=new URL(this.url,"https://course-js.javascript.ru/");i.searchParams.set("_sort",e),i.searchParams.set("_order",t),i.searchParams.set("_start",s.toString()),i.searchParams.set("_end",(s+n).toString());let a=[];return a=await Object(r.a)(i.href),this.removeLoadingInd(),a}setLoadingInd(){this.subElements.loading.style.display="block"}removeLoadingInd(){this.subElements.loading.style.display="none"}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.pointerdownHandler),document.addEventListener("scroll",this.scrollHandler)}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={},document.removeEventListener("scroll",this.scrollHandler)}}},,,function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(10);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor({from:e=new Date,to:t=new Date}={}){n(this,"element",null),n(this,"subElements",{}),n(this,"selectingFrom",!0),n(this,"handleDatePick",e=>{const t=e.target;if(!t.classList.contains("rangepicker__cell"))return;const s=new Date(t.dataset.value);this.selectingFrom?(this.removeSelected(),this.selectingFrom=!1,this.selected={from:s,to:null},this.highlightDates(this.selected)):(s<this.selected.from?(this.selected.to=this.selected.from,this.selected.from=s):this.selected.to=s,this.selectingFrom=!0,this.updateInput(),this.highlightDates(this.selected),this.closeSelector(),this.element.dispatchEvent(new CustomEvent("date-select",{bubbles:!0,detail:{from:this.selected.from,to:this.selected.to}})))}),n(this,"handleControlArrows",e=>{const t=e.target.className,s=t.slice(t.lastIndexOf("-")+1);let n=this.showDateFrom.getUTCMonth();"right"===s?n+=1:"left"===s&&(n-=1),Object(r.a)(this.showDateFrom,n),this.renderSelector(this.showDateFrom)}),n(this,"toggleSelector",e=>{""===this.subElements.selector.innerHTML.trim()&&this.renderSelector(this.selected.from),this.element.classList.toggle("rangepicker_open")}),n(this,"handleClickOutside",e=>{const t=this.element.classList.contains("rangepicker_open"),s=this.element.contains(e.target);t&&!s&&this.closeSelector()}),this.selected={from:this.getUTCMidnight(e),to:this.getUTCMidnight(t)},this.showDateFrom=new Date(this.selected.from.getTime()),this.render(),this.initEventListeners()}render(){const e=document.createElement("div");e.innerHTML=this.renderSkeleton(this.selected),this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element)}initEventListeners(){const{selector:e,input:t}=this.subElements;t.addEventListener("click",this.toggleSelector),e.addEventListener("click",this.handleDatePick),document.addEventListener("click",this.handleClickOutside,!0)}closeSelector(){this.element.classList.remove("rangepicker_open")}updateInput(){this.subElements.from.innerHTML=this.formatDate(this.selected.from),this.subElements.to.innerHTML=this.formatDate(this.selected.to)}renderSelector(e){const t=this.subElements.selector;t.innerHTML='\n      <div class="rangepicker__selector-arrow"></div>\n      <div class="rangepicker__selector-control-left"></div>\n      <div class="rangepicker__selector-control-right"></div>';const s=Array.from(t.querySelectorAll(".rangepicker__selector-control-left, .rangepicker__selector-control-right"));s.length&&s.forEach(e=>{e.addEventListener("click",this.handleControlArrows,!0)}),t.insertAdjacentHTML("beforeend",this.renderMonths(e)),this.highlightDates(this.selected)}highlightDates(e){const t=e.from.getTime(),s=e.to?e.to.getTime():null,r=this.getDatesButtons(),n=Date.parse(r[0].dataset.value),i=Date.parse(r[r.length-1].dataset.value);if(e.to){if(s<n||t>i)return}else if(t<n||t>i)return;r.forEach(r=>{let n=Date.parse(r.dataset.value);n===t&&r.classList.add("rangepicker__selected-from"),e.to&&(n>t&&n<s?r.classList.add("rangepicker__selected-between"):n===s&&r.classList.add("rangepicker__selected-to"))})}getDatesButtons(){return Array.from(this.subElements.selector.querySelectorAll(".rangepicker__cell"))}renderMonths(e){const t=[],s=e.getTime(),n=e.getUTCMonth();for(let e=0;e<2;e++){let i=new Date(s);Object(r.a)(i,n+e),t.push(this.renderOneMoth(i))}return t.join("")}renderOneMoth(e){return`\n      <div class="rangepicker__calendar">\n        <div class="rangepicker__month-indicator">\n          <time datetime="${this.toDateTime(e)}">\n            ${e.toLocaleDateString("ru",{month:"long",timeZone:"UTC"})}\n          </time>\n        </div>\n        <div class="rangepicker__day-of-week">\n            <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div>\n        </div>\n        <div class="rangepicker__date-grid">\n            ${this.renderDatesButtons(e)}\n        </div>\n      </div>`}renderDatesButtons(e){const t=new Date(e.getTime()),s=this.getBoundaryValues(t),r=0===s.firstDayNumber?7:s.firstDayNumber,n=[];for(let e=1;e<=s.lastDate;e++)t.setUTCDate(e),n.push(`\n            <button type="button"\n                class="rangepicker__cell"\n                data-value="${t.toISOString()}"\n                style="${1===e?"--start-from: "+r:""}">\n                ${e}\n            </button>\n        `);return n.join("")}getBoundaryValues(e){const t=new Date(e.getTime());t.setUTCDate(1);const s=t.getUTCDay();Object(r.a)(t,t.getUTCMonth()+1),t.setUTCDate(0);return{firstDayNumber:s,lastDate:t.getUTCDate()}}renderSkeleton(e){return`\n      <div class="rangepicker">\n        <div class="rangepicker__input" data-element="input">\n          <span data-element="from">${this.formatDate(e.from)}</span> -\n          <span data-element="to">${this.formatDate(e.to)}</span>\n        </div>\n         <div class="rangepicker__selector" data-element="selector"></div>\n      </div>`}formatDate(e){return e.toLocaleDateString("ru",{dateStyle:"short",timeZone:"UTC"})}toDateTime(e){const t=e.getUTCMonth()+1;return`${e.getUTCFullYear()}-${("0"+t).slice(-2)}`}removeSelected(){const e=this.getDatesButtons(),t=["rangepicker__selected-from","rangepicker__selected-between","rangepicker__selected-to"];e.forEach(e=>e.classList.remove.apply(e.classList,t))}getSubElements(e){const t=e.querySelectorAll("[data-element]");return Array.from(t).reduce((e,t)=>(e[t.dataset.element]=t,e),{})}getUTCMidnight(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={},document.removeEventListener("click",this.handleClickOutside,!0)}}}]]);
//# sourceMappingURL=sales-index-js-6.js.map