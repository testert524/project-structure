{"version":3,"sources":["webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/notification/index.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js","webpack:///./src/utils/fetch-json.js"],"names":["SortableList","constructor","items","event","element","target","closest","grabHandle","deleteHandle","preventDefault","this","grabListItem","remove","clientX","clientY","move","draggable","bottom","draggableBottom","getBoundingClientRect","prev","placeholder","previousElementSibling","next","nextElementSibling","defaultTopShift","before","after","scrollWhenNearWindowBorder","placeholderIndex","children","indexOf","removeDocumentListeners","replaceWith","style","classList","pointerShift","elementInitialIndex","dispatchEvent","from","to","render","initEventListeners","document","createElement","className","innerHTML","map","item","add","outerHTML","join","addEventListener","pointerdownHandler","addDocumentListeners","pointermoveHandler","pointerupHandler","removeEventListener","documentElement","clientHeight","window","scrollBy","draggableStyles","getComputedStyle","forEach","styleName","getPointerShift","append","ondragstart","left","top","x","y","type","detail","CustomEvent","bubbles","destroy","NotificationMessage","message","settings","duration","template","firstElementChild","show","parentElement","body","currentNotification","setTimeout","string","replace","BACKEND_URL","process","ProductForm","productId","title","description","quantity","subcategory","status","images","price","discount","loadImgButton","input","accept","onchange","async","imgFile","files","response","uploadToImgur","data","img","source","name","url","link","subElements","imageListContainer","getImageElement","MouseEvent","save","loadData","product","saveButton","innerText","categories","defaultProduct","subcategories","id","wrapper","getForm","getEmptyTemplate","getSubElements","fillFormWithObject","productForm","setSortableImageList","submit","elements","uploadImage","loadImage","method","fillObjectWithForm","URL","params","headers","JSON","stringify","fetchJson","href","error","console","log","Headers","formData","FormData","requestOptions","redirect","object","form","excludedFields","fields","Object","keys","filter","field","includes","convertToInt","imgHTMLCollection","querySelectorAll","parseInt","alt","src","Promise","all","getCategoriesPromise","getProductDataPromise","err","productUrl","searchParams","categoriesUrl","getCatSelectHTML","category","image","sortableList","escapeHtml","Array","reduce","result","subElement","dataset","Page","path","pathName","split","pop","initComponents","renderComponents","components","key","hasOwnProperty","showNotification","main","querySelector","setPageTitle","history","pushState","switchFromAddToEdit","Notification","pageTitle","component","values","fetch","toString","FetchError","ok","errorText","statusText","json","Error","super","reason","alert"],"mappings":"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","file":"products-edit-index-js-4.js","sourcesContent":["export default class SortableList {\n  element = null;\n  draggable = null;\n  placeholder = null;\n  pointerShift = {};\n  defaultTopShift = 5;\n\n  pointerdownHandler = event => {\n    const element = event.target.closest('.sortable-list__item');\n    const grabHandle = event.target.closest('[data-grab-handle]');\n    const deleteHandle = event.target.closest('[data-delete-handle]');\n\n    if (grabHandle) {\n      event.preventDefault();\n\n      this.grabListItem(element, event);\n    }\n\n    if (deleteHandle) {\n      element.remove();\n    }\n  };\n\n  pointermoveHandler = ({clientX, clientY}) => {\n    this.move(this.draggable, clientX, clientY);\n\n    const {bottom: draggableBottom} = this.draggable.getBoundingClientRect();\n\n    const prev = this.placeholder.previousElementSibling;\n    const next = this.placeholder.nextElementSibling;\n\n    if (prev) {\n      if (prev.getBoundingClientRect().bottom + this.defaultTopShift > draggableBottom) {\n        prev.before(this.placeholder);\n      }\n    }\n\n    if (next && next !== this.draggable) {\n      if (next.getBoundingClientRect().bottom - this.defaultTopShift < draggableBottom) {\n        next.after(this.placeholder);\n      }\n    }\n\n    this.scrollWhenNearWindowBorder(clientY);\n  };\n\n  pointerupHandler = event => {\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholder);\n\n    this.removeDocumentListeners();\n\n    this.placeholder.replaceWith(this.draggable);\n\n    this.draggable.style = '';\n    this.draggable.classList.remove('sortable-list__item_dragging');\n\n    this.draggable = null;\n    this.placeholder = null;\n    this.pointerShift = {};\n\n    if (placeholderIndex !== this.elementInitialIndex) {\n      this.dispatchEvent('sortable-list-reorder', {\n        from: this.elementInitialIndex,\n        to: placeholderIndex\n      });\n    }\n  };\n\n  constructor({items = []} = {}) {\n    this.items = items;\n\n    this.render();\n    this.initEventListeners();\n  }\n\n  render() {\n    this.element = document.createElement('ul');\n    this.element.className = 'sortable-list' ;\n    this.element.innerHTML = this.items.map(item => {\n      item.classList.add('sortable-list__item');\n\n      return item.outerHTML;\n    }).join('');\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('pointerdown', this.pointerdownHandler, true);\n  }\n\n  addDocumentListeners() {\n    document.addEventListener('pointermove', this.pointermoveHandler, true);\n    document.addEventListener('pointerup', this.pointerupHandler, true);\n  }\n\n  removeDocumentListeners() {\n    document.removeEventListener('pointermove', this.pointermoveHandler, true);\n    document.removeEventListener('pointerup', this.pointerupHandler, true);\n  }\n\n  scrollWhenNearWindowBorder(clientY) {\n    const windowHeight = document.documentElement.clientHeight;\n    const step = 10;\n    const indentFromWindowBorder = 20;\n\n    if (clientY >= windowHeight - indentFromWindowBorder) {\n      window.scrollBy(0, step);\n    }\n    if (clientY <= indentFromWindowBorder) {\n      window.scrollBy(0, -step);\n    }\n  }\n\n  grabListItem(element, {clientX, clientY}) {\n    const placeholder = document.createElement('li');\n    const necessaryStyles = ['height', 'width'];\n    const draggableStyles = getComputedStyle(element);\n\n    this.elementInitialIndex = [...this.element.children].indexOf(element);\n\n    necessaryStyles.forEach(styleName => {\n      placeholder['style'][styleName] = draggableStyles[styleName];\n      element['style'][styleName] = draggableStyles[styleName];\n    });\n\n    this.pointerShift = this.getPointerShift(element, clientX, clientY);\n\n    element.classList.add('sortable-list__item_dragging');\n    placeholder.className = 'sortable-list__placeholder';\n\n    element.before(placeholder);\n    this.element.append(element);\n\n    element.ondragstart = () => false;\n\n    this.move(element, clientX, clientY);\n\n    this.draggable = element;\n    this.placeholder = placeholder;\n\n    this.addDocumentListeners();\n  }\n\n  getPointerShift(draggable, clientX, clientY) {\n    const {left, top} = draggable.getBoundingClientRect();\n\n    return {\n      x: clientX - left,\n      y: clientY - top\n    };\n  }\n\n  move(element, clientX, clientY) {\n    element.style.left = clientX - this.pointerShift.x + 'px';\n    element.style.top = clientY - this.pointerShift.y + this.defaultTopShift + 'px';\n  }\n\n  dispatchEvent(type, detail) {\n    this.element.dispatchEvent(new CustomEvent(type, {\n      bubbles: true,\n      detail\n    }));\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.removeDocumentListeners();\n  }\n}\n","export default class NotificationMessage {\n  element = null;\n  static currentNotification = null;\n\n  constructor(message = '', settings = {\n    duration: 0,\n    type: 'error'\n  }) {\n    this.message = message;\n    this.duration = settings.duration;\n    this.type = settings.type;\n\n    this.render();\n  }\n\n  render() {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n    this.element = element.firstElementChild;\n  }\n\n  get template() {\n    return `\n      <div class=\"notification ${this.type === 'success' ? 'success' : 'error'}\" style=\"--value:${this.duration / 1000}s\">\n        <div class=\"timer\"></div>\n        <div class=\"inner-wrapper\">\n          <div class=\"notification-body\">\n            ${this.message}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  show(parentElement = document.body) {\n    if (NotificationMessage.currentNotification !== null) {\n      NotificationMessage.currentNotification.remove();\n    }\n    NotificationMessage.currentNotification = this;\n\n    this.element.classList.add('show');\n    parentElement.append(this.element);\n\n    setTimeout(() => {\n      this.remove();\n    }, this.duration);\n  }\n\n  remove () {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.remove();\n  }\n}\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","import SortableList from '../sortable-list/index.js';\nimport escapeHtml from '../../utils/escape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\n\nconst IMGUR_CLIENT_ID = process.env.IMGUR_CLIENT_ID;\nconst BACKEND_URL = process.env.BACKEND_URL;\n\nexport default class ProductForm {\n  element = null;\n  subElements = [];\n  product = {};\n  categories = {};\n  defaultProduct = {\n    title: '',\n    description: '',\n    quantity: 1,\n    subcategory: '',\n    status: 1,\n    images: [],\n    price: 100,\n    discount: 0\n  };\n\n  loadImage = event => {\n    const loadImgButton = event.target;\n    const input = document.createElement('input');\n\n    input.type = 'file';\n    input.accept = 'image/*';\n\n    input.onchange = async event => {\n      const [imgFile] = event.target.files;\n\n      loadImgButton.classList.add('is-loading');\n\n      const response = await this.uploadToImgur(imgFile);\n\n      loadImgButton.classList.remove('is-loading');\n\n      if (response && response.data) {\n        const img = {\n          source: imgFile.name,\n          url: response.data.link\n        };\n\n        this.subElements.imageListContainer.firstElementChild.append(this.getImageElement(img));\n      }\n    };\n\n    input.dispatchEvent(new MouseEvent(\"click\"));\n  };\n\n  submit = event => {\n    event.preventDefault();\n\n    this.save();\n  };\n\n  constructor (productId = null) {\n    this.productId = productId;\n  }\n\n  async switchFromAddToEdit(productId) {\n    this.productId = productId;\n\n    const data = await this.loadData(this.productId);\n    this.product = data.product;\n\n    this.subElements.saveButton.innerText = 'Edit product';\n  }\n\n  async render () {\n    const data = await this.loadData(this.productId);\n\n    this.product = data.product;\n    this.categories = data.categories;\n    this.defaultProduct.subcategory = this.categories[0].subcategories[0].id;\n\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.product\n      ? this.getForm()\n      : this.getEmptyTemplate();\n\n    this.element = wrapper.firstElementChild;\n\n    if (this.product) {\n      this.subElements = this.getSubElements(this.element);\n\n      this.fillFormWithObject(this.subElements.productForm, this.product);\n      this.setSortableImageList();\n\n      this.initEventListeners();\n    }\n\n    return this.element;\n  }\n\n  initEventListeners() {\n    const {productForm, imageListContainer} = this.subElements;\n\n    productForm.addEventListener('submit', this.submit);\n    productForm.elements.uploadImage.addEventListener('pointerdown', this.loadImage);\n  }\n\n  async save() {\n    const { productForm } = this.subElements;\n\n    let method = 'PUT';\n    let event = 'product-saved';\n\n    if (this.productId) {\n      method = 'PATCH';\n      event = 'product-edited';\n    }\n\n    this.fillObjectWithForm(this.product, productForm);\n\n    try {\n      const url = new URL('api/rest/products', BACKEND_URL);\n      const params = {\n        method: method,\n        headers: {\n          'Content-type': 'application/json;charset=utf-8'\n        },\n        body: JSON.stringify(this.product)\n      };\n\n      const response = await fetchJson(url.href, params);\n\n      this.element.dispatchEvent(new CustomEvent(event, {\n        bubbles: true,\n        detail: { response: response }\n      }));\n    } catch (error) {\n      console.log('error', error);\n    }\n  }\n\n  async uploadToImgur(imgFile) {\n    const headers = new Headers();\n    headers.append(\"Authorization\", `Client-ID ${IMGUR_CLIENT_ID}`);\n\n    const formData = new FormData();\n    formData.append('image', imgFile);\n\n    const requestOptions = {\n      method: 'POST',\n      headers: headers,\n      body: formData,\n      redirect: 'follow'\n    };\n\n    try {\n      return await fetchJson(\"https://api.imgur.com/3/image\", requestOptions);\n    } catch (error) {\n      console.log('error', error);\n    }\n  }\n\n  fillObjectWithForm(object, form) {\n    const excludedFields = ['images'];\n    const fields = Object.keys(this.defaultProduct).filter(field => !excludedFields.includes(field));\n    const convertToInt = ['price', 'discount', 'quantity', 'status'];\n    const imgHTMLCollection = this.subElements.imageListContainer.querySelectorAll('.sortable-table__cell-img');\n\n    fields.forEach(field => {\n      object[field] = convertToInt.includes(field)\n        ? parseInt(form.elements[field]['value'])\n        : form.elements[field]['value'];\n    });\n\n    object.images = [...imgHTMLCollection].map(img => {\n      return {\n        source: img.alt,\n        url: img.src\n      };\n    });\n\n    if (this.productId) {\n      object.id = this.productId;\n    }\n  }\n\n  fillFormWithObject(form, object) {\n    const excludedFields = ['images'];\n    const fields = Object.keys(this.defaultProduct).filter(field => !excludedFields.includes(field));\n\n    fields.forEach(field => {\n      form.elements[field]['value'] = object[field] || this.defaultProduct[field];\n    });\n  }\n\n  async loadData(id = null) {\n    try {\n      let [categories, [product]] = await Promise.all([\n        this.getCategoriesPromise(),\n        this.getProductDataPromise(id)\n      ]);\n\n      return {categories, product};\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  async getProductDataPromise(id) {\n    if (id) {\n      const productUrl = new URL('api/rest/products', BACKEND_URL);\n      productUrl.searchParams.append('id', id);\n\n      return fetchJson(productUrl.href);\n    } else {\n      return [this.defaultProduct];\n    }\n  }\n\n  async getCategoriesPromise() {\n    const categoriesUrl = new URL('api/rest/categories', BACKEND_URL);\n    categoriesUrl.searchParams.append('_sort', 'weight');\n    categoriesUrl.searchParams.append('_refs', 'subcategory');\n\n    return fetchJson(categoriesUrl.href);\n  }\n\n  getCatSelectHTML() {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.categories.map(category => {\n      if (category.subcategories) {\n        return category.subcategories.map(subcategory => {\n          return `<option value=\"${subcategory.id}\">${category.title} > ${subcategory.title}</option>`;\n        }).join('');\n      }\n    }).join('');\n\n    return wrapper.innerHTML;\n  }\n\n  setSortableImageList() {\n    const items = this.product.images.map(image => {\n      return this.getImageElement(image);\n    });\n\n    const sortableList = new SortableList({items});\n\n    this.subElements.imageListContainer.append(sortableList.element);\n  }\n\n  getImageElement(image) {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = `\n      <li class=\"products-edit__imagelist-item sortable-list__item\" style=\"\">\n        <span>\n            <img src=\"icon-grab.svg\" data-grab-handle=\"\" alt=\"grab\">\n            <img class=\"sortable-table__cell-img\" alt=\"${escapeHtml(image.source)}\" src=\"${escapeHtml(image.url)}\">\n            <span>${escapeHtml(image.source)}</span>\n        </span>\n        <button type=\"button\">\n          <img src=\"/icon-trash.svg\" data-delete-handle=\"\" alt=\"delete\">\n        </button>\n      </li>`;\n\n    return wrapper.firstElementChild;\n  }\n\n  getForm() {\n    return `\n      <div class=\"product-form\">\n        <form data-element=\"productForm\" class=\"form-grid\">\n\n          <div class=\"form-group form-group__half_left\">\n            <fieldset>\n              <label class=\"form-label\">Product name</label>\n              <input id=\"title\"\n                    required=\"\"\n                    type=\"text\"\n                    name=\"title\"\n                    class=\"form-control\"\n                    placeholder=\"Product name\">\n            </fieldset>\n          </div>\n\n          <div class=\"form-group form-group__wide\">\n            <label class=\"form-label\">Description</label>\n            <textarea id=\"description\"\n                    required=\"\"\n                    class=\"form-control\"\n                    name=\"description\"\n                    data-element=\"productDescription\"\n                    placeholder=\"Product description\">\n            </textarea>\n          </div>\n\n          <div class=\"form-group form-group__wide\">\n            <label class=\"form-label\">Image</label>\n\n            <div data-element=\"imageListContainer\"></div>\n\n            <button type=\"button\"\n                    name=\"uploadImage\"\n                    class=\"button-primary-outline fit-content\">\n                <span>Upload</span>\n             </button>\n          </div>\n\n          <div class=\"form-group form-group__half_left\">\n            <label class=\"form-label\">Category</label>\n            <select class=\"form-control\" name=\"subcategory\" id=\"subcategory\">\n                ${this.getCatSelectHTML()}\n            </select>\n          </div>\n\n          <div class=\"form-group form-group__half_left form-group__two-col\">\n            <fieldset>\n              <label class=\"form-label\">Price ($)</label>\n              <input id=\"price\"\n                    equired=\"\"\n                    type=\"number\"\n                    name=\"price\"\n                    class=\"form-control\"\n                    placeholder=\"${this.defaultProduct.price}\">\n            </fieldset>\n            <fieldset>\n              <label class=\"form-label\">Discount ($)</label>\n              <input id=\"discount\"\n                    required=\"\"\n                    type=\"number\"\n                    name=\"discount\"\n                    class=\"form-control\"\n                    placeholder=\"${this.defaultProduct.discount}\">\n            </fieldset>\n          </div>\n\n          <div class=\"form-group form-group__part-half\">\n            <label class=\"form-label\">Quantity</label>\n            <input id=\"quantity\"\n                    required=\"\"\n                    type=\"number\"\n                    class=\"form-control\"\n                    name=\"quantity\"\n                    placeholder=\"${this.defaultProduct.quantity}\">\n          </div>\n\n          <div class=\"form-group form-group__part-half\">\n            <label class=\"form-label\">Status</label>\n            <select id=\"status\" class=\"form-control\" name=\"status\">\n              <option value=\"1\">Active</option>\n              <option value=\"0\">Not active</option>\n            </select>\n          </div>\n\n          <div class=\"form-buttons\">\n            <button type=\"submit\" name=\"save\" class=\"button-primary-outline\" data-element=\"saveButton\">\n              ${this.productId ? 'Edit product' : 'Save product'}\n            </button>\n          </div>\n\n        </form>\n      </div>`;\n  }\n\n  getEmptyTemplate () {\n    return `<div>\n      <h1 class=\"page-title\">Page not found</h1>\n      <p>Sorry, this item does not exist.</p>\n    </div>`;\n  }\n\n  getSubElements(element) {\n    const subElements = Array.from(element.querySelectorAll('[data-element]'));\n\n    return subElements.reduce((result, subElement) => {\n      result[subElement.dataset.element] = subElement;\n\n      return result;\n    }, {});\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.subElements = [];\n    this.product = {};\n  }\n}\n","import ProductForm from '../../../components/product-form/index.js';\nimport Notification from '../../../components/notification';\n\nexport default class Page {\n  element;\n  subElements = {};\n  components = {};\n\n  constructor(path) {\n    const pathName = path.split('/').pop();\n\n    this.productId = (pathName === 'add') ? null : pathName;\n  }\n\n  async render() {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.template;\n    this.element = wrapper.firstElementChild;\n\n    this.subElements = this.getSubElements(this.element);\n\n    await this.initComponents();\n    this.renderComponents();\n    this.initEventListeners();\n\n    return this.element;\n  }\n\n  async initComponents() {\n    const productForm = new ProductForm(this.productId);\n\n    await productForm.render();\n\n    this.components = {\n      productForm,\n    };\n  }\n\n  renderComponents() {\n    Object.keys(this.subElements).forEach(key => {\n      if (this.components.hasOwnProperty(key)) {\n        this.subElements[key].append(this.components[key].element);\n      }\n    });\n  }\n\n  initEventListeners() {\n    this.subElements.productForm.addEventListener('product-edited', event => {\n      this.showNotification('success', 'Product has been edited');\n    });\n\n    this.subElements.productForm.addEventListener('product-saved', async (event) => {\n      const main = document.querySelector('main');\n\n      main.classList.add('is-loading');\n\n      this.productId =  event.detail.response.id;\n      this.setPageTitle('Edit');\n      history.pushState(null, null, '/products/' + this.productId);\n      await this.components.productForm.switchFromAddToEdit(this.productId);\n\n      main.classList.remove('is-loading');\n\n      this.showNotification('success', 'Product has been saved');\n    });\n  }\n\n  showNotification(type, message) {\n    const notification = new Notification(message, {\n      duration: 3000,\n      type: type\n    });\n\n    notification.show();\n  }\n\n  setPageTitle(title) {\n    this.subElements.pageTitle.innerHTML = `<a href=\"/products\" class=\"link\">Products</a> / ${title}`;\n  }\n\n  get template() {\n    const pageName = this.productId ? 'Edit' : 'Add';\n\n    return `<div class=\"products-edit\">\n              <div class=\"content__top-panel\">\n                <h1 class=\"page-title\" data-element='pageTitle'>\n                  <a href=\"/products\" class=\"link\">Products</a> / ${pageName}\n                </h1>\n              </div>\n              <div class=\"content-box\" data-element='productForm'></div>\n            </div>`;\n  }\n\n  getSubElements(element) {\n    const subElements = element.querySelectorAll('[data-element]');\n\n    return [...subElements].reduce((result, subElement) => {\n      result[subElement.dataset.element] = subElement;\n\n      return result;\n    }, {});\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    this.subElements = null;\n\n    for (const component of Object.values(this.components)) {\n      component.destroy();\n    }\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}