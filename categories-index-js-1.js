(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{12:function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}));class r{constructor({items:e=[]}={}){i(this,"element",null),i(this,"draggable",null),i(this,"placeholder",null),i(this,"pointerShift",{}),i(this,"defaultTopShift",5),i(this,"pointerdownHandler",e=>{const t=e.target.closest(".sortable-list__item"),n=e.target.closest("[data-grab-handle]"),i=e.target.closest("[data-delete-handle]");n&&(e.preventDefault(),this.grabListItem(t,e)),i&&t.remove()}),i(this,"pointermoveHandler",({clientX:e,clientY:t})=>{this.move(this.draggable,e,t);const{bottom:n}=this.draggable.getBoundingClientRect(),i=this.placeholder.previousElementSibling,r=this.placeholder.nextElementSibling;i&&i.getBoundingClientRect().bottom+this.defaultTopShift>n&&i.before(this.placeholder),r&&r!==this.draggable&&r.getBoundingClientRect().bottom-this.defaultTopShift<n&&r.after(this.placeholder),this.scrollWhenNearWindowBorder(t)}),i(this,"pointerupHandler",e=>{const t=[...this.element.children].indexOf(this.placeholder);this.removeDocumentListeners(),this.placeholder.replaceWith(this.draggable),this.draggable.style="",this.draggable.classList.remove("sortable-list__item_dragging"),this.draggable=null,this.placeholder=null,this.pointerShift={},t!==this.elementInitialIndex&&this.dispatchEvent("sortable-list-reorder",{from:this.elementInitialIndex,to:t})}),this.items=e,this.render(),this.initEventListeners()}render(){this.element=document.createElement("ul"),this.element.className="sortable-list",this.element.innerHTML=this.items.map(e=>(e.classList.add("sortable-list__item"),e.outerHTML)).join("")}initEventListeners(){this.element.addEventListener("pointerdown",this.pointerdownHandler,!0)}addDocumentListeners(){document.addEventListener("pointermove",this.pointermoveHandler,!0),document.addEventListener("pointerup",this.pointerupHandler,!0)}removeDocumentListeners(){document.removeEventListener("pointermove",this.pointermoveHandler,!0),document.removeEventListener("pointerup",this.pointerupHandler,!0)}scrollWhenNearWindowBorder(e){e>=document.documentElement.clientHeight-20&&window.scrollBy(0,10),e<=20&&window.scrollBy(0,-10)}grabListItem(e,{clientX:t,clientY:n}){const i=document.createElement("li"),r=getComputedStyle(e);this.elementInitialIndex=[...this.element.children].indexOf(e),["height","width"].forEach(t=>{i.style[t]=r[t],e.style[t]=r[t]}),this.pointerShift=this.getPointerShift(e,t,n),e.classList.add("sortable-list__item_dragging"),i.className="sortable-list__placeholder",e.before(i),this.element.append(e),e.ondragstart=()=>!1,this.move(e,t,n),this.draggable=e,this.placeholder=i,this.addDocumentListeners()}getPointerShift(e,t,n){const{left:i,top:r}=e.getBoundingClientRect();return{x:t-i,y:n-r}}move(e,t,n){e.style.left=t-this.pointerShift.x+"px",e.style.top=n-this.pointerShift.y+this.defaultTopShift+"px"}dispatchEvent(e,t){this.element.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:t}))}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.removeDocumentListeners()}}},13:function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}));class r{constructor(e="",t={duration:0,type:"error"}){i(this,"element",null),this.message=e,this.duration=t.duration,this.type=t.type,this.render()}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild}get template(){return`\n      <div class="notification ${"success"===this.type?"success":"error"}" style="--value:${this.duration/1e3}s">\n        <div class="timer"></div>\n        <div class="inner-wrapper">\n          <div class="notification-body">\n            ${this.message}\n          </div>\n        </div>\n      </div>\n    `}show(e=document.body){null!==r.currentNotification&&r.currentNotification.remove(),r.currentNotification=this,this.element.classList.add("show"),e.append(this.element),setTimeout(()=>{this.remove()},this.duration)}remove(){this.element.remove()}destroy(){this.remove()}}i(r,"currentNotification",null)},3:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var i=n(12),r=n(13),s=n(9);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(){o(this,"element",null),o(this,"subElements",{}),o(this,"toggleCategoryDropdown",e=>{e.target.classList.contains("category__header")&&e.target.parentElement.classList.toggle("category_open")}),o(this,"onOrderChange",async e=>{const t=[...e.target.children].map((e,t)=>({id:e.dataset.id,weight:t+1}));try{await this.send(t),this.showNotification("success","Category order saved")}catch(e){this.showNotification("error","Server side error! "+e)}})}async render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element);const t=await this.loadData();return this.renderComponents(t),this.initEventListeners(),this.element}async loadData(){const e=new URL("api/rest/categories","https://course-js.javascript.ru/");return e.searchParams.set("_sort","weight"),e.searchParams.set("_refs","subcategory"),await Object(s.a)(e.href)}renderComponents(e){this.subElements.categoriesContainer.append(...this.renderCategories(e))}renderCategories(e){return e.map(e=>{const t=this.getCategoryElement(e);return t.querySelector("[data-subcategory-list]").append(this.renderSubCategories(e)),t})}getCategoryElement(e){const t=document.createElement("div");return t.innerHTML=this.getCategoryTemplate(e),t.firstElementChild}renderSubCategories(e){return new i.a({items:e.subcategories.map(e=>{const t=document.createElement("li");return t.classList.add("categories__sortable-list-item","sortable-list__item"),t.dataset.grabHandle="",t.dataset.id=e.id,t.innerHTML=`<strong>${e.title}</strong>\n                               <span><b>${e.count}</b> products</span>`,t})}).element}get template(){return'\n        <div class="categories">\n          <div class="content__top-panel">\n            <h1 class="page-title">Categories</h1>\n          </div>\n          <div data-element="categoriesContainer"></div>\n        </div>'}getCategoryTemplate(e){return`\n        <div class="category category_open" data-id="${e.id}">\n          <header class="category__header">\n            ${e.title}\n          </header>\n          <div class="category__body">\n            <div class="subcategory-list" data-subcategory-list></div>\n          </div>\n        </div>`}initEventListeners(){document.addEventListener("pointerdown",this.toggleCategoryDropdown),document.addEventListener("sortable-list-reorder",this.onOrderChange)}async send(e){const t=new URL("api/rest/subcategories","https://course-js.javascript.ru/"),n={method:"PATCH",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)};await Object(s.a)(t,n)}showNotification(e,t){new r.a(t,{duration:3e3,type:e}).show()}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements=null,document.removeEventListener("pointerdown",this.toggleCategoryDropdown),document.removeEventListener("sortable-list-reorder",this.onOrderChange)}}},9:function(e,t,n){"use strict";t.a=async function(e,t){let n,r;try{n=await fetch(e.toString(),t)}catch(e){throw new i(n,"Network error has occurred.")}if(!n.ok){let e=n.statusText;try{r=await n.json(),e=r.error&&r.error.message||r.data&&r.data.error&&r.data.error.message||e}catch(e){}let t=`Error ${n.status}: ${e}`;throw new i(n,r,t)}try{return await n.json()}catch(e){throw new i(n,null,e.message)}};class i extends Error{constructor(e,t,n){var i,r,s;super(n),s="FetchError",(r="name")in(i=this)?Object.defineProperty(i,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[r]=s,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof i&&alert(e.reason.message)})}}]);
//# sourceMappingURL=categories-index-js-1.js.map